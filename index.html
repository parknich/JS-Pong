<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="game" width="480" height="320" style="z-index: 0"> </canvas>
  <script>
    console.log("Define variables");
    //global variables
    let canvas = document.getElementById("game");
    let ctx = canvas.getContext("2d");
    let dx = -3;
    let dy = 3;
    const basedy = 3;
    let x = canvas.width / 2;
    let y = canvas.height - 30;
    let paddle1Y = canvas.height / 2;
    let paddle1X = 20;
    let paddle2Y = canvas.height / 2;
    let paddle2X = 450;
    let keyDown = null;
    let gameStatus = "MainMenu";
    let isGameOver = false;
    let newDiv = document.createElement("div");
    let mouseX = null;
    let mouseY = null;
    let rect = null
    console.log("before keydown");

    console.log("after keydown");
    // ----define functions----
    console.log("Define Functions");

    function disableScroll() {
      document.body.classList.add("stop-scrolling");
    }

    function enableScroll() {
      document.body.classList.remove("stop-scrolling");
    }
    //draw
    function drawBall() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.rect(x, y, 10, 10);
      ctx.fillStyle = "#000000";
      ctx.font = "15px Courier New";
      ctx.fillText(`Ball X: ${x} Ball Y: ${y}`, 10, 20);
      ctx.fill();
      ctx.closePath();
      x += dx;
      y += dy;
    }
    function drawPaddle1() {
      ctx.beginPath();
      ctx.rect(paddle1X, paddle1Y, 10, 75);
      ctx.fillStyle = "#000000";
      ctx.fill();
      ctx.closePath();
    }
    function drawPaddle2() {
      ctx.beginPath();
      ctx.rect(paddle2X, paddle2Y, 10, 75);
      ctx.fillStyle = "#000000";
      ctx.fill();
      ctx.closePath();
    }
    console.log("BALL");
    // resize canvas
    function resizeCanvas() {}
    // ball
    function ballMovement() {
      if (y + dy > canvas.height - 10 || y + dy < 0) {
        dy = -dy;
      }
      if (x + dx > canvas.width - 10 || x + dx < 0) {
        gameStatus = "gameOver";
      }
      drawBall();
    }
    function paddleCollision() {
      if (
        x > paddle1X &&
        x < paddle1X + 10 &&
        y > paddle1Y &&
        y < paddle1Y + 75
      ) {
        dx = -dx;
        dy = basedy * Math.randomd();
        console.log("paddle1 collision");
      }
      if (
        x < paddle2X &&
        x > paddle2X - 10 &&
        y > paddle2Y &&
        y < paddle2Y + 75
      ) {
        dx = -dx;
        dy = basedy * Math.random();
        console.log("paddle2 collision");
      }
    }
    function paddleMovement() {
      if (keyDown == "w") {
        paddle1Y = paddle1Y - 5;
        console.log(keyDown);
      } else if (keyDown == "s") {
        paddle1Y = paddle1Y + 5;
        console.log(keyDown);
      } else if (keyDown == "ArrowUp") {
        paddle2Y = paddle2Y - 5;
        console.log(keyDown);
      } else if (keyDown == "ArrowDown") {
        paddle2Y = paddle2Y + 5;
      }
    }
    function gameOver() {
      if (gameStatus == "gameOver") {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.font = "40px Courier New";
        ctx.fillStyle = "#000000";
        ctx.fillText("Game Over", 130, canvas.height / 2);
        ctx.fill();
        ctx.closePath();
      }
    }
    function drawBackground() {
      ctx.globalCompositeOperation = "destination-over";
      ctx.beginPath();
      ctx.rect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#808080";
      ctx.fill();
      ctx.closePath();
    }
    function mainmenu() {
      if (gameStatus == "MainMenu") {
        const button1 = new Path2D()
        button1
        rect = button1
        ctx.fillStyle = "#000000";
        ctx.rect(165, canvas.height / 2, 140, 40);
        ctx.fill(button1)
        ctx.fillStyle = "#808080";
        ctx.font = "20px Courier New";
        ctx.fillText("2 Players", 180, 185);
      }
    }
    console.log("initialize game func");
    // the game
    document.addEventListener("keydown", (event) => {
      if (["w", "s", "ArrowUp", "ArrowDown"].includes(event.key)) {
        keyDown = event.key;
      } else {
        keyDown = null;
      }
    });
    document.addEventListener("keyup", (event) => {keyDown = null;});

    function getCursorPosition(canvas, event) {
      const bounds = canvas.getBoundingClientRect();
      mouseX = event.clientX - bounds.left;
      mouseY = event.clientY - bounds.top;
      console.log(`mouseX: ${mouseX} mouseY: ${mouseY}`);
    }
    canvas.addEventListener("click", ({ mouseX, mouseY }) => {
        if (ctx.isPointInPath(rect, mouseX, mouseY)) {
        gameStatus = "Active";
    }});
    document.addEventListener("mousemove",(event)=>{getCursorPosition(canvas,event)});
    function Game() {
      disableScroll();
      if (gameStatus == "Active") {
        ballMovement();
      } else if (gameStatus == "MainMenu") {
        mainmenu();
      }
      gameOver();
      if (gameStatus == "Active") {
        drawPaddle1();
        drawPaddle2();
        paddleCollision();
        paddleMovement();
      }
      drawBackground();
      window.requestAnimationFrame(Game);
    }
    //----end define functions----
    console.log("before request animation frame");
    Game();
    console.log("after request animation frame");
  </script>
</body>
