<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="game" width="480" height="320" style="z-index: 0"> </canvas>
  <script>
    console.log("Define variables");
    //global variables
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    let dx = -3;
    let dy = 3;
    let basedy = 3;
    let basedx = -3
    let x = canvas.width / 2;
    let y = canvas.height - 30;
    let paddle1Y = canvas.height / 2;
    let paddle1X = 20;
    let paddle2Y = canvas.height / 2;
    let paddle2X = 450;
    let keyDown = null;
    let gameStatus = "mainmenu";
    let isGameOver = false;
    const newDiv = document.createElement("div");
    let mouseX = null;
    let mouseY = null;
    let offsetX = null;
    let offsetY = null;
    let rect = null;
    let debug = true;
    let mouseDebug = false;
    const button2P = new Path2D();
    const buttonAI = new Path2D();
    const buttonRetry = new Path2D();
    console.log('after define variables')
    // ----define functions----
    console.log("Define Functions");

    function disableScroll() {
      document.body.classList.add("stop-scrolling");
    }

    function enableScroll() {
      document.body.classList.remove("stop-scrolling");
    }
    //draw
    function drawBall() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.rect(x, y, 10, 10);
      ctx.fillStyle = "#000000";
      ctx.font = "15px Courier New";
      ctx.fillText(`Ball X: ${x} Ball Y: ${y}`, 10, 20);
      ctx.fill();
      ctx.closePath();
      x += dx;
      y += dy;
    }
    function drawPaddle1() {
      ctx.beginPath();
      ctx.rect(paddle1X, paddle1Y, 10, 75);
      ctx.fillStyle = "#000000";
      ctx.fill();
      ctx.closePath();
    }
    function drawPaddle2() {
      ctx.beginPath();
      ctx.rect(paddle2X, paddle2Y, 10, 75);
      ctx.fillStyle = "#000000";
      ctx.fill();
      ctx.closePath();
    }
    console.log("BALL");
    // resize canvas
    function resizeCanvas() {}
    // ball
    function ballMovement() {
      if (y + dy > canvas.height - 10 || y + dy < 0) {
        dy = -dy;
      }
      if (x + dx > canvas.width - 10 || x + dx < 0) {
        gameStatus = "gameOver";
      }
      drawBall();
    }
    function paddleCollision() {
      if (
        x > paddle1X &&
        x < paddle1X + 10 &&
        y > paddle1Y &&
        y < paddle1Y + 75
      ) {
        dx = -dx;
        dy = basedy * Math.random();
        console.log("paddle1 collision");
      }
      if (
        x < paddle2X &&
        x > paddle2X - 10 &&
        y > paddle2Y &&
        y < paddle2Y + 75
      ) {
        dx = -dx;
        dy = basedy * Math.random();
        console.log("paddle2 collision");
      }
    }
    function paddleMovement() {
      if (keyDown == "w") {
        paddle1Y = paddle1Y - 5;
        console.log(keyDown);
      } else if (keyDown == "s") {
        paddle1Y = paddle1Y + 5;
        console.log(keyDown);
      } else if (keyDown == "ArrowUp") {
        paddle2Y = paddle2Y - 5;
        console.log(keyDown);
      } else if (keyDown == "ArrowDown") {
        paddle2Y = paddle2Y + 5;
      }
    }

    function drawBackground() {
      ctx.globalCompositeOperation = "destination-over";
      ctx.beginPath();
      ctx.rect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#808080";
      ctx.fill();
      ctx.closePath();
    }
    function menu() {
      if (gameStatus == "mainmenu") {
        ctx.fillStyle = "#000000";
        button2P.rect(165, canvas.height / 2, 140, 40);
        ctx.fill(button2P);  
        ctx.beginPath()
        ctx.fillStyle = "white";
        ctx.font = "20px Courier New"
        ctx.fillText('2 Players', 179, 185);
        ctx.fill();
        ctx.closePath()
      } else if (gameStatus == "mainmenu, AIDifficulty") {
        console.log('not done');
      } else if (gameStatus == "gameOver") {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.font = "40px Courier New";
        ctx.fillStyle = "#000000";
        ctx.fillText("Game Over", 130, canvas.height / 2);
        ctx.fill();
        ctx.font = "30px Georgia"
        ctx.fillStyle = "white";
        ctx.fillText('Retry', 194, 200);
        ctx.fill();
        ctx.closePath();
        buttonRetry.roundRect(181, 170, 100, 42, Math.PI * 3.5);
        ctx.fillStyle = "#000000";
        ctx.fill(buttonRetry);
      }
      
    }
    console.log("initialize game func");
    // the game
    document.addEventListener("keydown", (event) => {
      if (["w", "s", "ArrowUp", "ArrowDown"].includes(event.key)) {
        keyDown = event.key;
      } else {
        keyDown = null;
      }
    });
    document.addEventListener("keyup", (event) => {keyDown = null;});

    function getCursorPosition(canvas, event) {
      const bounds = canvas.getBoundingClientRect();
      mouseX = event.clientX - bounds.left;
      mouseY = event.clientY - bounds.top;
      offsetX = event.offsetX;
      offsetY = event.offsetY;
      if (mouseDebug == true) {
        console.log(`mouseX: ${mouseX} mouseY: ${mouseY}`);
        console.log(`offsetX: ${mouseX} offsetY: ${mouseY}`);
      }
    }
    canvas.addEventListener("click", ({ offsetX, offsetY }) => {
        if (ctx.isPointInPath(button2P, offsetX, offsetY) && gameStatus == 'mainmenu') {
          console.log('button2P clicked');
          gameStatus = "Active";
        } else if (ctx.isPointInPath(buttonRetry, offsetX, offsetY) && gameStatus == 'gameOver') {
          console.log('buttonRetry clicked')
          let randomStart = Math.floor(Math.random() * 4);
          x = canvas.width/2
          y = canvas.height/2
          switch (randomStart) {
              case 0:
                  console.log('0')
                  basedy = 3
                  basedx = 3
                  dx = dx;
                  dy = basedy * Math.random() - basedy;
              break;
              case 1:
                  console.log('1')
                  basedy -3
                  basedx = -3
                  dx = -dx;
                  dy = basedy * Math.random() - basedy;
              break;
              case 2:
                  console.log('2')
                  basedy = 3
                  basedx = -3
                  dx = -dx;
                  dy = basedy * Math.random();
              break;
              case 3:
                  console.log('3')
                  basedy = -3
                  basedx = 3
                  dx = dx;
                  dy = basedy * Math.random();
          }
          gameStatus = "Active";
        } 
    });
    document.addEventListener("mousemove",(event)=>{getCursorPosition(canvas,event)});
    function Game() {
      disableScroll();
      menu();
      if (gameStatus == "Active") {
        ballMovement();
        drawPaddle1();
        drawPaddle2();
        paddleCollision();
        paddleMovement();
      }
      drawBackground();
      window.requestAnimationFrame(Game);
    }
    //----end define functions----
    console.log("before request animation frame");
    Game();
    console.log("after request animation frame");
  </script>
</body>
